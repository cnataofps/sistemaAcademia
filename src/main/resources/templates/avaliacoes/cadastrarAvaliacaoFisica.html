<!DOCTYPE html>
<div lang="pt-br" xmlns:th="http://www.thymeleaf.org">

	<head th:replace="~{painel :: header}">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Cadastrar Avaliação Física</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

		<style>
			body {
				display: flex;
				flex-direction: column;
				min-height: 100vh;
				margin: 0;
				font-family: 'Inter', 'Roboto', sans-serif;
				background-color: #f8f9fa;
			}

			.main-layout {
				flex: 1;
				display: flex;
			}

			.sidebar {
				background-color: #ffffff;
				border-right: 1px solid #dee2e6;
				width: 250px;
				padding: 0;
			}

			.content-area {
				flex-grow: 1;
				padding: 2rem;
			}

			footer {
				width: 100%;
				background-color: #0d6efd;
				color: white;
				text-align: center;
				padding: 20px;
				margin-top: auto;
			}

			@media (max-width: 767.98px) {
				.main-layout {
					flex-direction: column;
				}

				.sidebar {
					width: 100%;
					border-right: none;
					border-bottom: 1px solid #dee2e6;
				}
			}

			/* Modo Noturno */
			body.dark-mode {
				background-color: #121212;
				color: #e0e0e0;
			}

			body.dark-mode .sidebar {
				background-color: #1f1f1f;
				border-color: #444;
			}

			body.dark-mode .sidebar .nav-link {
				color: #ccc;
			}

			body.dark-mode .sidebar .nav-link:hover {
				background-color: #333;
				color: #0d6efd;
			}

			body.dark-mode .sidebar .nav-link.active {
				background-color: #0d6efd;
				color: white;
			}

			body.dark-mode .content-area,
			body.dark-mode .container {
				background-color: #1e1e1e;
				color: #e0e0e0;
			}

			body.dark-mode h1,
			body.dark-mode label {
				color: #e0e0e0;
			}

			body.dark-mode .form-control {
				background-color: #2a2a2a !important;
				color: #e0e0e0 !important;
				border-color: #555 !important;
			}

			body.dark-mode .form-control::placeholder {
				color: #aaa !important;
			}

			body.dark-mode .btn-primary {
				background-color: #0d6efd !important;
				color: #fff !important;
				border-color: #0d6efd !important;
			}

			body.dark-mode .btn-outline-secondary {
				background-color: transparent !important;
				border-color: #ccc !important;
				color: #ccc !important;
			}

			body.dark-mode .btn-outline-secondary:hover {
				background-color: #ccc !important;
				color: #121212 !important;
			}

			body.dark-mode i.bi {
				color: #e0e0e0 !important;
			}

			.form-control,
			.btn {
				transition: background-color 0.3s ease, color 0.3s ease;
			}
		</style>
	</head>

	<div>
		<!-- Navbar -->
		<div th:replace="~{painel :: navbar}"></div>

		<!-- Layout principal -->
		<div class="main-layout">
			<!-- Sidebar -->
			<div th:replace="~{painel :: sidebar}" class="sidebar"></div>

			<!-- Área de conteúdo -->
			<div class="content-area">
				<div class="container">
					<div class="card shadow-sm mb-4">
						<div class="card-body">
							<h2 class="card-title text-primary mb-3">
								<i class="bi bi-clipboard-plus"></i> Cadastrar Avaliação Física
							</h2>

							<!-- Mensagem de sucesso ou erro -->
							<div th:if="${Mensagem}" class="alert alert-success alert-dismissible fade show"
								role="alert">
								<span th:text="${Mensagem}"></span>
								<button type="button" class="btn-close" data-bs-dismiss="alert"
									aria-label="Close"></button>
							</div>

							<!-- Formulário -->
							<form method="POST" action="/cadastrarAvaliacaoFisica" th:object="${avaliacaoFisica}">
								<div class="row g-3 mb-4">
									<div class="col-md-6">
										<label class="form-label">Dataaaaaaaaaaaaaaaa</label>
										<input type="date" th:field="*{data}" class="form-control" required>
									</div>
									<div class="col-md-6">
										<label class="form-label">Data Troca</label>
										<input type="date" th:field="*{dataTroca}" class="form-control" required>
									</div>
									<div class="col-md-12">
										<label class="form-label">Objetivo</label>
										<input type="text" th:field="*{objetivo}" class="form-control">
									</div>
								</div>

								<!-- Abas -->
								<ul class="nav nav-tabs mb-3" id="avaliacaoTabs" role="tablist">
									<li class="nav-item" role="presentation">
										<button class="nav-link" id="anamnese-tab" data-bs-toggle="tab"
											data-bs-target="#anamnese" type="button" role="tab">
											<i class="bi bi-journal-medical"></i> Anamnese
										</button>
									</li>

									<li class="nav-item" role="presentation">
										<button class="nav-link active" id="perimetria-tab" data-bs-toggle="tab"
											data-bs-target="#perimetria" type="button" role="tab">
											<i class="bi bi-rulers"></i> Perimetria
										</button>
									</li>
									<li class="nav-item" role="presentation">
										<button class="nav-link" id="antropometria-tab" data-bs-toggle="tab"
											data-bs-target="#antropometria" type="button" role="tab">
											<i class="bi bi-body-text"></i> Antropometria
										</button>
									</li>
								</ul>

								<div class="tab-content" id="avaliacaoTabsContent">
									<!-- Perimetria -->
									<div class="tab-pane fade show active" id="perimetria" role="tabpanel">
										<div class="row g-3">
											<div class="col-md-6"><label>Torax</label><input type="text"
													th:field="*{torax}" class="form-control"></div>
											<div class="col-md-6"><label>Abdominal</label><input type="text"
													th:field="*{abdominal}" class="form-control"></div>
											<div class="col-md-6"><label>Quadril</label><input type="text"
													th:field="*{quadril}" class="form-control"></div>
											<div class="col-md-6"><label>Antebraço</label><input type="text"
													th:field="*{antebraco}" class="form-control"></div>
											<div class="col-md-6"><label>Braço Relaxado</label><input type="text"
													th:field="*{bracorelaxado}" class="form-control"></div>
											<div class="col-md-6"><label>Braço Contraído</label><input type="text"
													th:field="*{bracocontraido}" class="form-control"></div>
											<div class="col-md-6"><label>Coxa Superior</label><input type="text"
													th:field="*{coxasuperior}" class="form-control"></div>
											<div class="col-md-6"><label>Panturilha</label><input type="text"
													th:field="*{panturilha}" class="form-control"></div>
										</div>
									</div>
									<!-- Antropometria -->
									<div class="tab-pane fade" id="antropometria" role="tabpanel">
										<div class="col-md-6">
											<label>Idade</label>
											<input type="number" class="form-control" id="idade" min="1" max="120"
												required>
										</div>
										<div class="col-md-6">
											<label>Sexo</label>
											<select class="form-control" id="sexo" required>
												<option value="">Selecione</option>
												<option value="masculino">Masculino</option>
												<option value="feminino">Feminino</option>
											</select>
										</div>

										<div class="row g-3 mt-3">
											<div class="col-md-6"><label>Tricipal</label><input type="text"
													th:field="*{tricipal}" class="form-control" id="tricipal"></div>
											<div class="col-md-6"><label>Subescapular</label><input type="text"
													th:field="*{subescapular}" class="form-control" id="subescapular">
											</div>
											<div class="col-md-6"><label>Peitoral</label><input type="text"
													th:field="*{peitoral}" class="form-control" id="peitoral"></div>
											<div class="col-md-6"><label>Abdômen</label><input type="text"
													th:field="*{abdomen}" class="form-control" id="abdomen"></div>
											<div class="col-md-6"><label>Supra-ilíaca</label><input type="text"
													th:field="*{suprailiaca}" class="form-control" id="suprailiaca">
											</div>
											<div class="col-md-6"><label>Coxa</label><input type="text"
													th:field="*{coxa}" class="form-control" id="coxa"></div>
											<div class="col-md-6"><label>Axilar Média</label><input type="text"
													th:field="*{axialmedia}" class="form-control" id="axialmedia"></div>
											<div class="col-md-6"><label>Peso</label><input type="number"
													th:field="*{peso}" class="form-control" step="0.01" id="peso"></div>
											<div class="col-md-6"><label>Altura</label><input type="number"
													th:field="*{altura}" class="form-control" step="0.01" id="altura">
											</div>
											<div class="col-md-6"><label>IMC</label><input type="number"
													th:field="*{imc}" class="form-control" step="0.01" id="imc"
													readonly></div>
											<div class="col-md-6"><label>% Gordura</label><input type="number"
													th:field="*{percentualgordura}" class="form-control" step="0.01"
													id="percentualgordura" readonly></div>
											<div class="col-md-6"><label>Massa Magra</label><input type="number"
													th:field="*{massamagra}" class="form-control" step="0.01"
													id="massamagra" readonly></div>
											<div class="col-md-6"><label>Massa Gorda</label><input type="number"
													th:field="*{massagorda}" class="form-control" step="0.01"
													id="massagorda" readonly></div>
										</div>
									</div>

									<!-- Aba Anamnese -->
									<div class="tab-pane fade" id="anamnese" role="tabpanel">
										<div class="row g-4 mt-3">
											<!-- Título geral -->
											<h5 class="text-primary">Anamnese</h5>


											<div class="row">
												<!-- Histórico Pessoal -->
												<div class="col-md-4">
													<h6 class="text-secondary">Histórico Pessoal</h6>

													<label class="form-label">Problema articular</label>
													<div class="d-flex gap-4 mb-2">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{problemaArticular}" value="sim"
																id="problemaArticularSim">
															<label class="form-check-label"
																for="problemaArticularSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{problemaArticular}" value="nao"
																id="problemaArticularNao">
															<label class="form-check-label"
																for="problemaArticularNao">Não</label>
														</div>
													</div>

													<label class="form-label">Cirurgia</label>
													<div class="d-flex gap-4 mb-2">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{cirurgia}" value="sim" id="cirurgiaSim">
															<label class="form-check-label"
																for="cirurgiaSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{cirurgia}" value="nao" id="cirurgiaNao">
															<label class="form-check-label"
																for="cirurgiaNao">Não</label>
														</div>
													</div>

													<label class="form-label">Coluna</label>
													<div class="d-flex gap-4">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{coluna}" value="sim" id="colunaSim">
															<label class="form-check-label" for="colunaSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{coluna}" value="nao" id="colunaNao">
															<label class="form-check-label" for="colunaNao">Não</label>
														</div>
													</div>
												</div>

												<!-- Histórico Familiar -->
												<div class="col-md-4">
													<h6 class="text-secondary">Histórico Familiar</h6>

													<label class="form-label">Cardiopata</label>
													<div class="d-flex gap-4 mb-2">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{cardiopata}" value="sim" id="cardiopataSim">
															<label class="form-check-label"
																for="cardiopataSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{cardiopata}" value="nao" id="cardiopataNao">
															<label class="form-check-label"
																for="cardiopataNao">Não</label>
														</div>
													</div>

													<label class="form-label">Hipertenso</label>
													<div class="d-flex gap-4 mb-2">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{hipertenso}" value="sim" id="hipertensoSim">
															<label class="form-check-label"
																for="hipertensoSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{hipertenso}" value="nao" id="hipertensoNao">
															<label class="form-check-label"
																for="hipertensoNao">Não</label>
														</div>
													</div>

													<label class="form-label">Diabético</label>
													<div class="d-flex gap-4">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{diabetico}" value="sim" id="diabeticoSim">
															<label class="form-check-label"
																for="diabeticoSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{diabetico}" value="nao" id="diabeticoNao">
															<label class="form-check-label"
																for="diabeticoNao">Não</label>
														</div>
													</div>
												</div>

												<!-- Hábitos Pessoais -->
												<div class="col-md-4">
													<h6 class="text-secondary">Hábitos Pessoais</h6>

													<label class="form-label">Fuma</label>
													<div class="d-flex gap-4 mb-2">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{fuma}" value="sim" id="fumaSim">
															<label class="form-check-label" for="fumaSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{fuma}" value="nao" id="fumaNao">
															<label class="form-check-label" for="fumaNao">Não</label>
														</div>
													</div>

													<label class="form-label">Bebe</label>
													<div class="d-flex gap-4 mb-2">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{bebe}" value="sim" id="bebeSim">
															<label class="form-check-label" for="bebeSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{bebe}" value="nao" id="bebeNao">
															<label class="form-check-label" for="bebeNao">Não</label>
														</div>
													</div>

													<label class="form-label">Tóxico</label>
													<div class="d-flex gap-4">
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{toxico}" value="sim" id="toxicoSim">
															<label class="form-check-label" for="toxicoSim">Sim</label>
														</div>
														<div class="form-check">
															<input class="form-check-input" type="radio"
																th:field="*{toxico}" value="nao" id="toxicoNao">
															<label class="form-check-label" for="toxicoNao">Não</label>
														</div>
													</div>
												</div>
											</div>
										</div>

										<!-- Atividade Física -->
										<h5 class="text-primary mt-4">Atividade Física</h5>

										<div class="row g-3">
											<div class="col-md-6">
												<label class="form-label">Já fez musculação</label>
												<div class="d-flex gap-4">
													<div class="form-check">
														<input class="form-check-input" type="radio"
															th:field="*{jaFezMusculacao}" value="sim"
															id="musculacaoSim">
														<label class="form-check-label" for="musculacaoSim">Sim</label>
													</div>
													<div class="form-check">
														<input class="form-check-input" type="radio"
															th:field="*{jaFezMusculacao}" value="nao"
															id="musculacaoNao">
														<label class="form-check-label" for="musculacaoNao">Não</label>
													</div>
												</div>
											</div>
										</div>

										<div class="row g-3 mt-2">
											<div class="col-md-6">
												<label class="form-label">Tempo de musculação (meses/anos)</label>
												<input type="text" th:field="*{tempoMusculacao}" class="form-control"
													placeholder="Ex: 6 meses, 2 anos">
											</div>
											<div class="col-md-6">
												<label class="form-label">Frequência semanal</label>
												<input type="text" th:field="*{frequenciaSemanal}" class="form-control"
													placeholder="Ex: 3x por semana">
											</div>
										</div>

										<div class="row g-3 mt-2">
											<div class="col-md-6">
												<label class="form-label">Inativo há (meses/anos)</label>
												<input type="text" th:field="*{inativoHa}" class="form-control"
													placeholder="Ex: 3 meses, 1 ano">
											</div>
											<div class="col-md-6">
												<label class="form-label">Tempo disponível</label>
												<input type="text" th:field="*{tempoDisponivel}" class="form-control"
													placeholder="Ex: 1h por dia">
											</div>
										</div>

										<div class="row mt-3">
											<div class="col-12">
												<label class="form-label">Observações</label>
												<textarea th:field="*{observacao}" class="form-control" rows="4"
													placeholder="Informações adicionais sobre o aluno ou avaliação"></textarea>
											</div>
										</div>

										<!-- Seleção de Aluno -->
										<div class="col-12 mt-4">
											<h5 class="text-primary">Selecionar Aluno</h5>
											<label class="form-label">Aluno</label>
											<select class="form-select" th:field="*{aluno.id}" required>
												<option value="" disabled selected>Selecione um aluno</option>
												<option th:each="aluno : ${alunos}" th:value="${aluno.id}"
													th:text="${aluno.nome}"></option>
											</select>
										</div>

										<!-- Botões -->
										<div class="col-12 mt-4 d-flex justify-content-start gap-3">
											<button type="submit" class="btn btn-success btn-lg">
												<i class="bi bi-check-circle"></i> Salvar Avaliação Física
											</button>
											<a href="/listarAvaliacoesFisica" class="btn btn-outline-secondary btn-lg">
												<i class="bi bi-arrow-left-circle"></i> Voltar </a>
							</form>
						</div> <!-- Fecha card-body -->
					</div> <!-- Fecha card -->
				</div> <!-- Fecha container -->
			</div> <!-- Fecha content-area -->
		</div> <!-- Fecha main-layout -->
	</div>
</div>
</div>
</div>


<!-- RODAPÉ -->
<div th:replace="fragments/footer :: footer"></div>



<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		const toggle = document.getElementById('toggleDarkMode');
		const body = document.body;

		if (localStorage.getItem('modoNoturno') === 'true') {
			body.classList.add('dark-mode');
		}

		if (toggle) {
			toggle.addEventListener('click', function () {
				body.classList.toggle('dark-mode');
				localStorage.setItem('modoNoturno', body.classList.contains('dark-mode'));
			});
		}
	});
</script>

<script>
	function calcularAntropometria() {
		const peso = parseFloat(document.getElementById("peso").value) || 0;
		const altura = parseFloat(document.getElementById("altura").value) || 0;
		const idade = parseInt(document.getElementById("idade").value) || 0;
		const sexo = document.getElementById("sexo").value;

		const tricipal = parseFloat(document.getElementById("tricipal").value) || 0;
		const subescapular = parseFloat(document.getElementById("subescapular").value) || 0;
		const peitoral = parseFloat(document.getElementById("peitoral").value) || 0;
		const abdomen = parseFloat(document.getElementById("abdomen").value) || 0;
		const suprailiaca = parseFloat(document.getElementById("suprailiaca").value) || 0;
		const coxa = parseFloat(document.getElementById("coxa").value) || 0;
		const axialmedia = parseFloat(document.getElementById("axialmedia").value) || 0;

		// IMC
		if (peso > 0 && altura > 0) {
			const imc = peso / (altura * altura);
			document.getElementById("imc").value = imc.toFixed(2);
		}

		// Soma das 7 dobras
		const somaDobras = tricipal + subescapular + peitoral + abdomen + suprailiaca + coxa + axialmedia;

		if (somaDobras > 0 && peso > 0 && idade > 0 && sexo) {
			let densidade = 0;

			if (sexo === "masculino") {
				densidade = 1.112 - 0.00043499 * somaDobras + 0.00000055 * Math.pow(somaDobras, 2) - 0.00028826 * idade;
			} else if (sexo === "feminino") {
				densidade = 1.097 - 0.000468 * somaDobras + 0.00000056 * Math.pow(somaDobras, 2) - 0.000128 * idade;
			}

			const percentualGordura = ((4.95 / densidade) - 4.5) * 100;
			const massaGorda = peso * (percentualGordura / 100);
			const massaMagra = peso - massaGorda;

			document.getElementById("percentualgordura").value = percentualGordura.toFixed(2);
			document.getElementById("massagorda").value = massaGorda.toFixed(2);
			document.getElementById("massamagra").value = massaMagra.toFixed(2);
		}
	}

	// Escuta os campos da aba Antropometria
	const campos = ["peso", "altura", "idade", "sexo", "tricipal", "subescapular", "peitoral", "abdomen", "suprailiaca", "coxa", "axialmedia"];
	campos.forEach(id => {
		document.getElementById(id).addEventListener("input", calcularAntropometria);
		document.getElementById(id).addEventListener("change", calcularAntropometria);
	});
</script>

</body>

</html>